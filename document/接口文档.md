## 返回 json格式统一说明

包含以下属性

```java
T data			//T为泛型的类型标记
String msg      //返回的信息（错误原因等）
int ResultCode	//状态码，现在定义了四种，如下
```

ResultCode取值情况如下

```java
public interface ResultCode {
    int success=1;
    int fail=2;
    int exception=3;
    int abnormal=4;
}
```



## 接口

### IP

**47.93.218.244**

### 基本震情接口

##### 1、上传基本震情的json文件

类型：get

URL：/disasterUpload

参数：file

参数类型：MultipartFile

返回：

```json
success情况
{
    "msg": "success",
    "data": "none",
    "ResultCode": 1
}
```

```json
abnormal情况
{
    "msg": "no file",
    "data": "none",
    "ResultCode": 4
}
```

```json
exception情况
{
    "msg": "json data is out of standard",
    "data": "none",
    "ResultCode": 3
}
```

##### 2、拿到全部的disaster，带搜索，分页

类型：get

URL：/getDisaster

参数：

```java
String key
Integer page
Integer limit
```

返回：47.93.218.244/getDisaster?key=182&page=1&limit=5

```json
{
    "code": 0,		//状态码
    "msg": "",		//信息，基本用不到
    "count": 1,		//总共查询到的个数
    "data": [		//下面是当前页的数据
        {
            "id": 182,
            "unifiedId": "501",
            "province": "安徽",
            "city": "马鞍山",
            "country": "当涂县",
            "town": "",
            "village": "",
            "date": "2020-07-03 12:54:21",
            "location": "安徽马鞍山当涂县",
            "longitude": 10.0,
            "latitude": 20.0,
            "depth": 1.0,
            "magnitude": 2.0,
            "picture": "182.jpg",		//这个图片可以通过 【域名+“/disaster/”+picture显示】
            							//比如这里的http://47.93.218.244/disaster/182.jpg
            "reportingUnit": null,
            "deathPeople": 190,
            "injuredPeople": 286,
            "missingPeople": 241,
            "did": "34052100000020200703125421"
        }
    ]
}
```

##### 3、根据ID删除disaster

类型：delete

URL：/deleteDisasterInfoById

参数：

```java
int id			//基本震情的ID
```

返回：

```json
{				//失败
    "msg": "the id doesn't exist",
    "data": "none",
    "ResultCode": 4
}
```

```json
{				//成功
    "msg": "delete success",
    "data": "none",
    "ResultCode": 1
}
```

##### 4、根据ID修改disaster

类型：get

URL：/updateDisasterInfoById

参数：

```java
int id,
String province,
String city,
String country,
String town,
String village,
String date,
double longitude,
double latitude,
float depth,
float magnitude,
String reportingUnit,
MultipartFile file    			//需要修改图片的话
```

返回：

/updateDisasterInfoById?id=154&province=安徽&city=马鞍山&country=当涂县&town=姑孰镇&village=&date=2020-04-03 12:54:21&longitude=10&latitude=20&depth=1&magnitude=2&reportingUnit=当涂地震局

```json
{
    "msg": "update success",
    "data": "none",
    "ResultCode": 1
}
```

/updateDisasterInfoById?id=154&province=安徽省&city=马鞍山&country=当涂县&town=姑孰镇&village=&date=2020-04-03 12:54:21&longitude=10&latitude=20&depth=1&magnitude=2&reportingUnit=当涂地震局

```json
{
    "msg": "the location or date is invalid",
    "data": "none",
    "ResultCode": 4
}
```

##### 5、添加新的disaster

类型：get

URL：/addDisasterInfo

参数：

```java
MultipartFile file,			//图片文件同时上传，前端检查一下文件大小
String province,
String city,
String country,
String town,
String village,
String date,
double longitude,
double latitude,
float depth,
float magnitude,
String reportingUnit
```

返回：（body里面还有multipartfile）

/addDisasterInfo?province=安徽&city=马鞍山&country=当涂县&town=&village=&date=2020-07-03 12:54:21&longitude=10&latitude=20&depth=1&magnitude=2& reportingUnit=当涂地震局

```json
{
    "msg": "add success",
    "data": {
        "id": 142					//插入数据的ID号
    },
    "ResultCode": 1
}
```

/addDisasterInfo?province=安徽省&city=马鞍山&country=当涂县&town=&village=&date=2020-07-03 12:54:21&longitude=10&latitude=20&depth=1&magnitude=2& reportingUnit=当涂地震局

```json
{
    "msg": "the location or date is invalid",
    "data": "none",
    "ResultCode": 4
}
```

##### 6、从FTP服务器读取基本数据（这里提供了基本震情、受灾人员的读取）

类型：get

URL：/ftpConfig

正确：  47.93.218.244/ftpConfig?ip=42.193.127.60&user=ftpuser&passwd=123&interval=0

参数：

```java
String ip
String user
String passwd
int interval				//定时读取的时间间隔，一定要传，不然报500错误
```

返回：

成功  

```json
{
    "msg": "connect success, and basic disaster insert success    connect success, and people data insert success",
    "data": "0",
    "ResultCode": 1
}
```

失败之一

```json
{
    "msg": "connect fail (please check the ip,username,password)",
    "data": "none",
    "ResultCode": 4
}
```

##### 7、基本灾情的地图数据

类型：get

URL：/MapData

参数：

```java
String startDate
String endDate
```

返回：

成功	/MapData?startDate=2020-04-01 12:00:00&endDate=2021-05-01 12:00:00

```json
{
    "msg": "success",
    "data": {
        "coordinate": {
            "北京东城区": [
                40.16,
                116.63
            ],
            "安徽马鞍山当涂县姑孰镇": [
                20.0,
                10.0
            ],
            "山西省长治市潞州区": [
                35.5,
                113.01
            ]
        },
        "info": [
            {
                "depth": 1.0,
                "latitude": 20.0,
                "name": "安徽马鞍山当涂县姑孰镇",
                "magnitude": 2.0,
                "value": 392,
                "longitude": 10.0
            },
            {
                "depth": 15.0,
                "latitude": 40.16,
                "name": "北京东城区",
                "magnitude": 7.0,
                "value": 9,
                "longitude": 116.63
            },
            {
                "depth": 10.0,
                "latitude": 35.5,
                "name": "山西省长治市潞州区",
                "magnitude": 5.5,
                "value": 7,
                "longitude": 113.01
            }
        ]
    },
    "ResultCode": 1
}
```

失败	/MapData?startDate="2020-04-01 12:00:00"&endDate=2021-05-01 12:00:00

```json
{
    "msg": "Timestamp format must be yyyy-mm-dd hh:mm:ss[.fffffffff]",
    "data": "none",
    "ResultCode": 4
}
```

##### 8、基本震情按照年份计数
类型：get

URL：/yearCount

参数：

```java
无
```

返回：

成功	
```json
[
    {"name":"2006","value":1},
    {"name":"2010","value":1},
    {"name":"2019","value":2},
    {"name":"2020","value":2},
    {"name":"2021","value":1}
]
```

##### 9、基本震情按照省份计数
类型：get

URL：/provinceCount

参数：

```java
无
```

返回：

成功	
```json
[
    {"name":"上海","value":1},
    {"name":"北京","value":1},
    {"name":"四川","value":2},
    {"name":"安徽","value":1},
    {"name":"山西","value":1},
    {"name":"重庆","value":1}
]
```


### 人员伤亡灾情接口
##### 1、获取人员死亡、受伤、失踪的人数

类型：get

URL：/getDistressedPeoplePercentage

参数：
```java
String earthquakeId
```
示例：

47.93.218.244/getDistressedPeoplePercentage?earthquakeId=43050200600420210520115027

返回：

成功
```json
{
  "code":0,
  "msg":"",
  "count":3,
  "data":[
      {
        "name":"死亡",
        "value":32
      },
      {
        "name":"受伤",
        "value":10
      },
      {
        "name":"失踪",
        "value":9
      }
  ]
}
```

失败
```json
{
  "code":2,
  "msg":"could not find distress with the earthquakeId",
  "count":0,
  "data":null
}
```

##### 2、受灾人群的表格数据

类型：get

URL：/getDistressedPeopleByEarthquakeId

参数：

```java
String earthquakeId		//对应的地震编码code
String key				//搜索关键字（地理位置）
int page				//两个参数用来分页
int limit
```

示例：

47.93.218.244/getDistressedPeopleByEarthquakeId?earthquakeId=11010100100120210423000000&key=&page=1&limit=3

返回：

```json
{
    "code": 0,
    "msg": "",
    "count": 15,
    "data": [
        {
            "id": 1,
            "peopleId": "",
            "province": "北京",
            "city": "市辖区",
            "country": "东城区",
            "town": "东华门街道",
            "village": "多福巷社区居委会",
            "location": "北京东城区",
            "date": "2021-03-23 00:00:07",
            "number": 20,
            "category": 0,
            "reportingUnit": "北京地震局",
            "earthquakeId": "11010100100120210423000000"
        },
        {
            "id": 2,
            "peopleId": "",
            "province": "北京市",
            "city": "市辖区",
            "country": "东城区",
            "town": "东华门街道",
            "village": "多福巷社区居委会",
            "location": "北京东城区",
            "date": "2021-03-23 00:20:07",
            "number": 36,
            "category": 0,
            "reportingUnit": "北京地震局",
            "earthquakeId": "11010100100120210423000000"
        },
        {
            "id": 3,
            "peopleId": "",
            "province": "北京市",
            "city": "市辖区",
            "country": "东城区",
            "town": "东华门街道",
            "village": "多福巷社区居委会",
            "location": "北京东城区",
            "date": "2021-03-23 01:55:57",
            "number": 5,
            "category": 0,
            "reportingUnit": "北京地震局",
            "earthquakeId": "11010100100120210423000000"
        }
    ]
}
```

##### 3、首页上最近的地震信息展示

类型：get

URL：/getRecentDisaster

参数：

```java
int number			//需要最近的几条数据，你们看放几条比较好看
```

示例：

47.93.218.244/getRecentDisaster?number=3

返回：	

这边返回的数据重复，不用管，（为了测试，我把限制部分的代码去掉了，不是问题，受灾人数据为0也不用管，测试数据问题

```json
{
    "code": 0,
    "msg": "",
    "count": 3,				//实际返回的条数，可能总共的数据没有请求的参数多
    "data": [
        {
            "id": 35,
            "unifiedId": "501",
            "province": "湖南",
            "city": "邵阳",
            "country": "双清区",
            "town": "桥头街道",
            "village": "肖家排社区",
            "date": "2021-05-20 11:50:27",
            "location": "湖南省邵阳市双清区",
            "longitude": 111.5,
            "latitude": 27.24,
            "depth": 3.0,
            "magnitude": 6.0,
            "picture": "35.jpg",
            "reportingUnit": "湖南地震局",
            "deathPeople": 190,						//死亡总数
            "injuredPeople": 286,					//受伤总数
            "missingPeople": 241,					//失踪总数
            "did": "43050200600420210520115027"
        },
        {
            "id": 23,
            "unifiedId": "501",
            "province": "湖南",
            "city": "邵阳",
            "country": "双清区",
            "town": "桥头街道",
            "village": "肖家排社区",
            "date": "2021-05-20 11:50:27",
            "location": "湖南省邵阳市双清区",
            "longitude": 111.5,
            "latitude": 27.24,
            "depth": 3.0,
            "magnitude": 6.0,
            "picture": "23.jpg",
            "reportingUnit": "湖南地震局",
            "deathPeople": 190,
            "injuredPeople": 286,
            "missingPeople": 241,
            "did": "43050200600420210520115027"
        },
        {
            "id": 47,
            "unifiedId": "501",
            "province": "湖南",
            "city": "邵阳",
            "country": "双清区",
            "town": "桥头街道",
            "village": "肖家排社区",
            "date": "2021-05-20 11:50:27",
            "location": "湖南省邵阳市双清区",
            "longitude": 111.5,
            "latitude": 27.24,
            "depth": 3.0,
            "magnitude": 6.0,
            "picture": "47.jpg",
            "reportingUnit": "湖南地震局",
            "deathPeople": 190,
            "injuredPeople": 286,
            "missingPeople": 241,
            "did": "43050200600420210520115027"
        }
    ]
}
```

##### 4、获取震情详细信息

类型：get

URL：/getDisasterDetailByEarthquakeId

参数：

```java
String earthquakeId
```

返回：

成功

```json
{
  "code":0,
  "msg":"",
  "count":1,
  "data":[
      {
          "id": 47,
          "unifiedId": "501",
          "province": "湖南",
          "city": "邵阳",
          "country": "双清区",
          "town": "桥头街道",
          "village": "肖家排社区",
          "date": "2021-05-20 11:50:27",
          "location": "湖南省邵阳市双清区",
          "longitude": 111.5,
          "latitude": 27.24,
          "depth": 3.0,
          "magnitude": 6.0,
          "picture": "47.jpg",
          "reportingUnit": "湖南地震局",
          "did": "43050200600420210520115027"
      }
  ]
}
```

失败

```json
{
  "code":2,
  "msg":"could not find disaster with the earthquakeId",
  "count":0,
  "data":null
}
```

##### 5、根据ID删除人员伤亡灾情

类型：delete

URL：/deleteDistressedPeopleById

参数：

```json
//失败
{
    "msg": "DistressedPeople id does not exist",
    "data": "none",
    "ResultCode": 4
}
```

```json
//成功
{
    "msg": "delete success",
    "data": "none",
    "ResultCode": 1
}
```

##### 6、增加人员伤亡灾情

类型：get

URL：/addDistressedPeople

参数：
```java
String province,
String city,
String country,
String town,
String village,
String datetime,
int number,
int category,
String reportingUnit,
String earthquakeId
```

```json
//成功
{
    "msg": "add distressed people info success",
    "data": "none",
    "ResultCode": 1
}
```

```json
//失败 
//地理位置错误
{
    "msg": "the location can not find code",
    "data": "none",
    "ResultCode": 4
}
```
```json
//找不到对应的震情信息
{
    "msg": "can not find disaster with this EarthquakeId",
    "data": "none",
    "ResultCode": 4
}
```
```json
//插入错误
{
    "msg": "add distressed people info fail",
    "data": "none",
    "ResultCode": 3
}
```

##### 7、根据id更新人员伤亡灾情信息

类型：get

URL：/updateDistressedPeople

参数：
```java
int id,
String province,
String city,
String country,
String town,
String village,
String datetime,
int number,
int category,
String reportingUnit,
String earthquakeId
```

```json
//成功
{
    "msg": "update success",
    "data": "none",
    "ResultCode": 1
}
```

```json
//失败 
//地理位置错误
{
    "msg": "the location can not find code",
    "data": "none",
    "ResultCode": 4
}
```
```json
//找不到对应的震情信息
{
    "msg": "can not find disaster with this EarthquakeId",
    "data": "none",
    "ResultCode": 4
}
```
```json
//插入错误
{
    "msg": "update fail",
    "data": "none",
    "ResultCode": 3
}
```
```json
//找不到该id对应的记录
{
    "msg": "can not find Distressed People data with the id",
    "data": "none",
    "ResultCode": 4
}
```

##### 8、将灾情信息按照地区划分统计伤亡总人数

类型：get

URL：/getDistressedPeopleCountDividedByLocation

参数：
```java
String earthquakeId
```

```json
//成功
//存在下一级位置
{
    "code":1,
    "msg":null,
    "count":3,
    "data":[
        {"name":"东城区","value":12},
        {"name":"朝阳区","value":30},
        {"name":"西城区","value":50}
    ]
}
```


```json
//成功
//但灾情信息中不存在下一级位置，返回基本震情的地理位置及总伤亡人数
{
    "code":1,
    "msg":"no location in DistressedPeople lower than disaster location",
    "count":1,
    "data":[
      {"name":"北京市辖区","value":92}
    ]
}
```

```json
//失败 
//找不到对应的震情信息
{
    "code":4,
    "msg":"can not find disaster information with this earthquakeId",
    "count":0,
    "data":null
}
```




